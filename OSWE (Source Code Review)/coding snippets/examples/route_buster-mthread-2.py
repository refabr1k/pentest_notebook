#!/usr/bin/env python3

import argparse
import requests
import concurrent.futures
import sys

parser = argparse.ArgumentParser()
parser.add_argument('-a', '--actionlist', help='actionlist to use')
parser.add_argument('-t', '--target', help='host/ip to target', required=True)
parser.add_argument('-w', '--wordlist', help='wordlist to use')
args = parser.parse_args()
actions = []

with open(args.actionlist, "r") as a:
    for line in a:
        try:
            actions.append(line.strip())
        except:
            print("Exception occurred")

def perform_requests(target, word, action):
    url = "{target}/{word}/{action}".format(target=target, word=word.strip(), action=action)
    r_get = requests.get(url=url).status_code
    r_post = requests.post(url=url).status_code
    return word, action, r_get, r_post

def print_progress(progress):
    sys.stdout.write("\rProgress: {}/{}".format(progress[0], progress[1]))
    sys.stdout.flush()

def print_result(result):
    if result:
        word, action, r_get, r_post = result
        if (r_get not in [204, 401, 403, 404] or r_post not in [201, 401, 403, 404]):
            print('                        \r', end='')
            print("/{word}/{action:10} - \t{get}\t{post}".format(word=word.strip(), action=action, get=r_get, post=r_post))

word_list = []
with open(args.wordlist, "r") as f:
    word_list = [line.strip() for line in f]

progress_total = len(word_list) * len(actions)
progress_count = 0

with concurrent.futures.ThreadPoolExecutor(max_workers=100) as executor:
    future_to_request = {
        executor.submit(perform_requests, args.target, word, action): (word, action)
        for word in word_list
        for action in actions
    }

    for future in concurrent.futures.as_completed(future_to_request):
        word, action = future_to_request[future]
        try:
            result = future.result()
            print_result(result)  # Print result as soon as available
        except Exception as e:
            print(f"Exception: {e}")

        progress_count += 1
        print_progress((progress_count, progress_total))

print('\r', end='')
print("Wordlist complete.")
