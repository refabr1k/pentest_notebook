# postMessage - Cross window messaging

A window can send messages to another window by using `postMessage` API call. 

Sender (hosted at `http://domain1.com`) sends message 
```javascript

..
popup = open("http://target.site/to.php")
..

function sendCustomMessage(){
	popup.postMessage("Hi there", "http://victim.site/to.php");
}


```

A window to receive messages will handle the event
```javascript

window.addEventListener("message", receiveMessage, false);

function receiveMessage(event) {
	if (event.origin !== "http://trusted.site"){
	..

}

```

## (vulnerable) Accepts message from every sourcec

```javascript
<script>
window.addEventListener("message", receiveMessage, false);
function receiveMessage(event) {
	console.log("Message received")
	// do some actions
	// ..
	
}
</script>
```

## (not vulnerable) Verifies origin 
```javascript
...
if (event.origin !== "http://trusted.site") {
	console.log("Message from an unauthorized origin!");
	return;s
}

```
