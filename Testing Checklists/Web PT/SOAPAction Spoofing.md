# SOAPAction spoofing

# Enumerating WSDL
WSDL files gives us a full list of operations and types allowd by the server, as well as the correct syntax to use, inputs and outputs and all useful information we may need to run successful attacks

## Google dorking
| Filter | Description |
| -- | -- |
| filetype:wsdl |  To filter by WSDL file type |
| site: targetUrl | To filter by site | 
| inurl:wsdl | To filter all URLs with the string WSDL | 

To search all of the indexed WSDL files on the target
www.vuln.att, you would use the following search string: `site:www.vuln.att filetype:wsdl`


## Append wsdl files to end of URL
Use the following
- `?wsdl`
- `.wsdl`
- `?disco`
e.g.
`http://site/searchEngineWS.php?wsdl`

DISCO is a Microsoft .NET Web Services discovery tool used to discover the URLs of XML Web services


## Taking advantage of WSDL
1. The attacker starts the client application and gets the WSDL file 
2. The attacker analyzes the WSDL file to look for hidden methods and to get general information about the structure of each operation 
3. The attacker invokes some (hidden) methods

- The attacker has access to the WSDL file and knows two interesting operations: getUserInfo and deleteAllStudents 
- A firewall filters out requests coming from remote clients invoking the operation deleteAllStudents. Local client requests are allowed. 
- The firewall uses only the SOAP body to filter requests. 
- The server application relies on the SOAPAction header to detect the operation type.

e.g. The remote application client can perform the following request because the getStudentInfo operation has not been firewalled.
```
POST /StudentsWS.php HTTP/1.1
Host: soap.site
Connection: Keep-Alive
User-Agent: PHP-SOAP/5.4.39-0+deb7u2
Content-Type: text/xml; charset=utf-8
SOAPAction: "getStudentInfo"
Content-Length: 230

<?xml version="1.0" encoding="UTF-8"?>
<SOAP-ENV:Envelope xmlns:SOAPENV="http://schemas.xmlsoap.org/soap/en
velope/"><SOAP-ENV:Body><SOAPENV:getStudentInfo><id>1</id></SOAPENV:getStudentInfo></SOAPENV:Body></SOAP-ENV:Envelop
```

The remote attacker can invoke the method `deleteAllStudents` by sending an HTTP request with the `SOAPAction` header set to deleteAllStudents and the SOAP body set as the previous request