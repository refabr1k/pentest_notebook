### SecurityAudit Policy - how to enumerate

```bash

aws iam list-users
#Check groups for users.
aws iam list-groups-for-user --user-name ad-adminson 

#Check policies attached to the user.
aws iam list-attached-user-policies --user-name ad-user 

#Check for any signing certificates for the user.
aws iam list-signing-certificates --user-name ad-user

#Check for any public ssh keys for the user.
aws iam list-ssh-public-keys --user-name ad-user

#Get ssh key details.
aws iam get-ssh-public-key --user-name ad-user --encoding PEM --ssh-public-key-id APKAUAWOPGE5M47NZEIT

#Check for MFA devices for users.
aws iam list-virtual-mfa-devices

#Check for user login profile.
aws iam get-login-profile --user-name ad-user

#Enumerate groups for the AWS account.
aws iam list-groups

#Check which policies are attached to the group to enumerate permissions.
aws iam list-group-policies --group-name ad-admin
aws iam list-attached-group-policies --group-name ad-admin

#Enumerate policies for the AWS account.
aws iam list-policies

#Searching for customer managed policies
aws iam list-policies --scope Local | grep -A2 PolicyName

#Check for policy details of ad-customer-managed-policy.
aws iam get-policy --policy-arn arn:aws:iam::276384657722:policy/ad-customer-managed-policy

#Get the policy version document to check permissions that the policy grants.
Command: aws iam get-policy-version --policy-arn arn:aws:iam::276384657722:policy/ad-customer-managed-policy --version-id v1

#Enumerate roles on the AWS account.
aws iam list-roles

#Check details for roles.
aws iam get-role --role-name ad-loggingrole

#Check for policies attached to roles.
aws iam list-attached-role-policies --role-name ad-loggingrole
aws iam list-role-policies --role-name ad-loggingrole
```

#### iam get-user
```bash
#-------- get-user ----------
aws --profile flaws iam get-user
	{
	    "User": {
	        "Path": "/",
	        "UserName": "Level6",
	        "UserId": "AIDAIRMDOSCWGLCDWOG6A",
	        "Arn": "arn:aws:iam::975426262029:user/Level6",
	        "CreateDate": "2017-02-26T23:11:16+00:00"
	    }
	}
```

#### iam list-attached-user-policies
```bash
#-------- get policies attached to user ----------
aws --profile flaws iam list-attached-user-policies --user-name Level6
	{
	    "AttachedPolicies": [
	        {
	            "PolicyName": "MySecurityAudit",
	            "PolicyArn": "arn:aws:iam::975426262029:policy/MySecurityAudit"
	        },
	        {
	            "PolicyName": "list_apigateways",
	            "PolicyArn": "arn:aws:iam::975426262029:policy/list_apigateways"
	        }
	    ]
	}
```

### iam get-policy
```bash
# ----------- Get policy version ID ----------------
aws --profile flaws iam get-policy  --policy-arn arn:aws:iam::975426262029:policy/list_apigateways
	{
	    "Policy": {
	        "PolicyName": "list_apigateways",
	        "PolicyId": "ANPAIRLWTQMGKCSPGTAIO",
	        "Arn": "arn:aws:iam::975426262029:policy/list_apigateways",
	        "Path": "/",
	        "DefaultVersionId": "v4",
	        "AttachmentCount": 1,
	        "PermissionsBoundaryUsageCount": 0,
	        "IsAttachable": true,
	        "Description": "List apigateways",
	        "CreateDate": "2017-02-20T01:45:17+00:00",
	        "UpdateDate": "2017-02-20T01:48:17+00:00",
	        "Tags": []
	    }
	}
```

### iam get-policy-version 
```bash
#----------- see actual policy based on version ------------
aws --profile flaws iam get-policy-version  --policy-arn arn:aws:iam::975426262029:policy/list_apigateways --version-id v4
	{
	    "PolicyVersion": {
	        "Document": {
	            "Version": "2012-10-17",
	            "Statement": [
	                {
	                    "Action": [
	                        "apigateway:GET" #OBSERVE THIS
	                    ],
	                    "Effect": "Allow",
	                    "Resource": "arn:aws:apigateway:us-west-2::/restapis/*" #OBSERVE THIS
	                }
	            ]
	        },
	        "VersionId": "v4",
	        "IsDefaultVersion": true,
	        "CreateDate": "2017-02-20T01:48:17+00:00"
	    }
	}
```

