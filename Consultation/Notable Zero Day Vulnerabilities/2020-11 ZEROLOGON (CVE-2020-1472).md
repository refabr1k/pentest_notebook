# What?
This vulnerability allows an unauthenticated attacker with network access to a domain controller, to establish a vulnerable Netlogon session and eventually gain domain administrator privileges. The vulnerability is especially severe since the only requirement for a successful exploit is the ability to establish a connection with a domain controller.

# How?
The core of the vulnerability lies in a poor implementation of the ComputeNetlogonCredential call of the Netlogon Remote Protocol (MS-NRPC). The ComputeNetlogonCredential takes an 8-byte challenge as an input, performs a cryptographic transformation using a session key (which proves knowledge of the computer secret), and outputs an 8-byte result. The issue lies in an implementation flaw in the newer method AES-CFB8 (which is also the only one allowed in newer Windows versions) which is used to perform this transformation. 

- Vulnerability lies in the implementation of "ComputeNetlogonCredential" call or the Netlogon remote protocol (MS-NRPC).
- The ComputeNetlogonCredential takes an 8-byte challenge as an input, performs a cryptographic transformation using a session key, outputs a 8-byte result.
- Issue lies in that
1. Initialization Vector (IV) not randomized - ComputeNetlogonCredential function sets the IV to a fixed value of 16 zero bytes. The issue is that in 1 in 256 chance crypto flaw that 8-bytes of zeros could get ciphertext of **zeros**
2. Unencrypted netlogon sessions are not rejected by servers (by default).



## Here is a summary of the exploitation steps:

1.  Establish an unsecure Netlogon channel against a domain controller by performing a [brute-force attack](https://www.crowdstrike.com/blog/maze-ransomware-analysis-and-protection/) using an 8 zero-bytes challenge and ciphertext, while spoofing the identity of that same domain controller. This would require an average of 256 attempts (given the probability of success being 1 in 256).
2.  Use the **NetrServerPasswordSet2** call to set the domain controller account’s password, as stored in Active Directory, to an empty one. This breaks some of the domain controller functionality, since the password stored in the domain controller’s registry does not change (this is the reason step four noted below is taken).
3.  Use the empty password to connect to that same domain controller and dump additional hashes using the Domain Replication Service (DRS) protocol.
4.  Revert the domain controller password to the original one as stored in the local registry to avoid detection.
5.  Use the hashes dumped from stage 3 to perform any desired attack such as Golden Ticket or pass the hash using domain administrator credentials.



https://www.crowdstrike.com/blog/cve-2020-1472-zerologon-security-advisory/



# Defence
## How to Protect Your Network

1.  Patch. Apply the relevant [Microsoft patch](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2020-1472) as quickly as possible! 
2.  Proactively close patch gaps. Non-Windows machines are still somewhat unprotected from ZeroLogon. Search your network for non-Windows computer accounts with elevated privileges (e.g. domain replication privileges) as these could be used to launch a successful ZeroLogon attack even on patched domain controllers. (Falcon Zero Trust can provide you with a complete list of privileged accounts.) 
3.  If you cannot patch for any reason:

-   An attacker exploiting the vulnerability effectively gets privileged access to a domain controller. Using this access, the attacker can harvest credentials and then perform one of the following attacks:
    -   Golden Ticket attack
    -   Pass-the-Hash attack
    -   Silver Ticket attack
-   Falcon Zero Trust can prevent these attacks via enforced step-up authentication.

1.  To mitigate further damage, ensure you are monitoring your environment against such attacks:

-   Enable multi-factor authentication (MFA) for all accounts or at least privileged accounts. In that case, even if a privileged account is compromised, the access attempt would still be denied.
-   Monitor for possible exploitation attempts with the [open-source tool](https://github.com/preempt/ntlm-scanner) released by CrowdStrike (formerly Preempt).