import requests
from datetime import datetime, timezone, timedelta
import pytz


url = "http://answers:8888/generateMagicLink"
data = {"username": "Evelyn"}
proxies = {"http":"http://127.0.0.1:8080", "https":"https://127.0.0.1:8080"}

# response = requests.post(url, data=data)
# headers = {"Content-Type":"application/x-www-form-urlencoded"}
response = requests.post(url=url,data=data,proxies=proxies)

date_header = response.headers.get('date')
print("Date from Response header = ", date_header)

# Parse the date string into a datetime object
date_object = datetime.strptime(date_header, "%a, %d %b %Y %H:%M:%S %Z")

utc_timezone = pytz.timezone('UTC')
date_object_utc = utc_timezone.localize(date_object)

# Convert the datetime object to epoch time (seconds since January 1, 1970)
epoch_time = int(date_object_utc.timestamp() * 1000)

# Calculate the time 2 seconds before the given date_header
time_before = date_object_utc - timedelta(seconds=1)

# Calculate the time 2 seconds after the given date_header
time_after = date_object_utc + timedelta(seconds=1)

# Convert both times to epoch format (seconds since January 1, 1970)
epoch_time_before = int(time_before.timestamp() * 1000)
epoch_time_after = int(time_after.timestamp() * 1000)


print("Epoch Time from Response          :", epoch_time)
print("Epoch Time from Response (+1 sec) :", epoch_time_after)
