https://github.com/sensepost/objection


```bash

# get package name
frida-ps -Uai 

# For emulators
objection --gadget <package name> explore

```


# non rooted device

```bash
# for non-rooted device
objection explore


#check architecture
adb shell getprop ro.product.cpu.abi

# Patch apk (make sure to check the architecture of device)
objection patchapk --source .\SecureStorev1.apk -a x86


## settings on device
enable developer options > enable USB debugging

# install using adb
adb install SecureStorev1.objection.apk


# check that frida server is injected 
# also observe that app starts in 'pause' mode when u run it
frida-ps -Uai

# hook into the app "Gadget"
# observe that the application resumes from 'pause' state and continues - meaning it was successfully hooked
frida -U -n Gadget

```


# Network Capture 
## For SDK < 24 
Below works if SDK < 24. By default only system certs are allowed for after SDK version 24.


- burp export .DER cert and rename as 'burp.crt'
- push cert to android `adb push burp.crt /mnt/sdcard`
- wifi install certs and give it a pin
- under wifi settings > modify > add burp proxy 
		
		if using emulator, the default IP for local host would be '10.0.2.2'
		
- check burpsuite if there is any issue when intercepting, if not successful you will see an error message in event log saying "The client failed to negotiate a TLS connection to...." 


## Patch network-security-config
- apktool unpack and observe 'AndroidManifest.xml' and observe that there is network security configuration in play (in this file the type of certificates that are used are defined) `android:networkSecurityConfig="@xml/network_security_config"`
- navigate to the `unpacked folder > res > xml > network_security_config.xml`  file and add `<certificates src="user" />` to tell the app to use user defined certs

```xml
<?xml version="1.0" encoding="utf-8"?>
<network-security-config>
    <base-config>
        <trust-anchors>
            <certificates src="user" />
            <certificates src="system" />
        </trust-anchors>
    </base-config>
</network-security-config>
```

- repackage the app `apktool b <folder>` and look for the new packaged app in `folder > dist` folder 

		This cannot be installed directly as it is not signed
		
- sign app (need JAVA JDK > bin in PATH)
```bash
#generate key
keytool -genkey -v -keystore <keystore_name> -alias <alias> -keyalg RSA -keysize 2048 -validity 10000

# sign jar
jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore <keystore_name> <apk file> <alias>
```