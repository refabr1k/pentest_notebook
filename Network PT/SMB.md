# SMB

* [https://0xdf.gitlab.io/2018/12/02/pwk-notes-smb-enumeration-checklist-update1.html\#nmblookupAnother](https://0xdf.gitlab.io/2018/12/02/pwk-notes-smb-enumeration-checklist-update1.html#nmblookupAnother) 
* [http://www.madirish.net/59](http://www.madirish.net/59)

tcp 445,135,139
udp 137

## SMBCLIENT

```bash

smbclient -L //10.10.10.10 -N 

# use smb1
smbclient -L //10.10.10.10 --option='client min protocol=NT1' -U"administrator"

# connect to shares null sessions
smbclient --no-pass -N \\\\1.2.3.4\\Shares

```

## smbmap

```

## SMBMap

```bash
smbmap -H 192.168.1.5

 [+] Finding open SMB ports....
 [+] User SMB session establishd on [ip]...
 [+] IP: [ip]:445        Name: [ip]                                     
         Disk                                                    Permissions
         ----                                                    -----------
         ADMIN$                                                  NO ACCESS
         C$                                                      NO ACCESS
         IPC$                                                    NO ACCESS
         NETLOGON                                                NO ACCESS
         Replication                                             READ ONLY
         SYSVOL                                                  NO ACCESS
```

## nmap

```bash

# smb enum
nmap -p 139,445 --script smb-enum-users <ipaddress_here>

# check os
nmap -v -p 139,445 --script smb-os-discovery 10.11.24.85

# check smb vuln
nmap -v -p 139,445 --script vuln <ipaddress_here>
```

## nbtscan
```bash

# subnet scan
nbtscan -r 10.11.24.0/24
nbtscan -A 10.10.10.10


```
``


## Enum4Linux

`enum4linux -v 192.168.1.200`
`enum4linux -A 192.168.1.200`

## net view (windows)

```powershell
net view 10.10.10.10

net use \\10.10.10.10\IPC$ '' /u:''
# The command completed successfully.

net use \\10.10.10.10\ADMIN$ '' /u:
# System error 5 has occurred.

```


## NMBLookup

```bash
nmblookup -A 192.168.0.5

# Looking up status of [ip]
#         [hostname]      <00> -         M <ACTIVE>
#         [hostname]      <20> -         M <ACTIVE>
#         WORKGROUP       <00> - <GROUP> M <ACTIVE>
#         WORKGROUP       <1e> - <GROUP> M <ACTIVE>
#                         <03> -         M <ACTIVE>
#         INet~Services   <1c> - <GROUP> M <ACTIVE>
#         IS~[hostname]   <00> -         M <ACTIVE>
# MAC Address = 00-50-56-XX-XX-XX
```


## RPCClient

_Null sessions, In windows NT2000/XP default config for SMB allows for nullsessions to be created. In windows 2003/XP SP2 onwards, this is disabled. Use RPCClient to explore nullsessions._

```bash
Rpcclient -U "" 129.168.1.200

#Server info such as OS version, server type
srvinfo

#Users information
enumdomusers

#Show password policy
getdompwinfo

#Domain info
querydomaininfo

#find net share
netshareenum

```
