# Java visual studio - example 1


1. Install visual studio code
2. Configure Frappe to debug.

	 - ssh frappe > `nano /home/frappe/frappe-bench/Procfile`
	 - comment `#web: bench serve --port 8000`
	 - Start ptvsd and pauses runtime until a debugger is attached to the process. `nano /home/frappe/frappe-bench/apps/frappe/frappe/app.py` > insert the following at line 9
	 
	```
	import ptvsd
	ptvsd.enable_attach(redirect_output=True)
	print("Now ready for the IDE to connect to the debugger")
	ptvsd.wait_for_attach()
	```

 3. Load the code into Visual Studio Code.
	
	- Copy code to Kali to debug remotely e.g using rsync 
	```
	rsync -azP frappe@192.168.121.123:/home/frappe/frappe-bench ./
	``` 
	- start the necessary
	```bash
	cd ~/frappe-bench/
	bench start
	cd /home/frappe/frappe-bench/sites
	
	# get ready for debugger to attach remotely
	../env/bin/python ../apps/frappe/frappe/utils/bench_helper.py frappe serve --port 8000 --noreload --nothreading
	```

4. Configure Visual Studio Code to connect to the remote debugger.

	- open folder > go to any file with file ext of language eg. `file.py`
	- left explorer view > click ''Run and Debug" tab
	-  click `create a launch.json file` > select `Remote Attach` and enter target host IP
	- modify starting directory of target host to point to workspace `eg. "remoteRoot": "/home/frappe/frappe-bench/"`
	- click Run > Start Debugging

# Java visual studio - example 2

remote debuggin java
import dependency

```bash
unzip -j NumberGame.jar "BOOT-INF/lib/*" -d NumberGame/lib/
```

check that dependencies are loaded
```
visual studio code > java projects > dependencies (may need to switch to standard mode)
```

create a launch.json
```
	> visual studio code > debug > run and debug > 'create a launch.json file'
	> add configuration > Java: Attach to Remote Program
	> change hostname and port value eg. 127.0.0.1 port 9898
```

launch remote debugger
```
> java -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=9898 -jar NumberGame.jar
	> access app on port 8000 on browser
```

Attach debugger
```
	> VS code > click Run (for run view) > click dropdown menu next to green arrow > attach to remote program > select configuration > start debugging
	
```

---

# Managed .NET code

- csc.exe from .net framework to compile `.cs` files into executable e.g. `C:\...Microsoft.NET\Framework64\v4.0.30319\csc.exe test.cs`

- dnspy to decompile exe files
	- exe > dotnetapp > program to see source code
	- find cross references:
		- open all dll > search > search for: method > selected file > search term eg. base64
	- modify assembly attribute:
		exe > dotnetapp > program > right click program > edit code
		file > save all

---

# Debugging DLL/EXE (DNYSPY)

### DNSPY recompile assembly for debugging

Application may have debug mode off, so you cannot set breakpoints. You can recompile the assembly to enable 'debugging' and then 'attach to process' to debug

1. make a backup of dll
2. dnSpy > open dll > explorer > rightclick dll "Edit Assembly Attributes (C#)"
3. replace:
```C#
//ORIGINAL
[assembly:
Debuggable(DebuggableAttribute.DebuggingModes.IgnoreSymbolStoreSequencePoints)]

//REPLACE WITH
[assembly: Debuggable(DebuggableAttribute.DebuggingModes.Default | DebuggableAttribute.DebuggingModes.DisableOptimizations | DebuggableAttribute.DebuggingModes.IgnoreSymbolStoreSequencePoints | DebuggableAttribute.DebuggingModes.EnableEditAndContinue)]
```
4. click compile
5. File > Save Module
6. Reset IIS 
```c#
iisreset /noforce
```

### Attach to Process
1. DNSPY close all first
2. DNSPY > Debug > Attach to Process > "w3wp.exe"
3. Debug > pause all execution (to pause all execution)
4. Debug > windows > modules (to list all modules)
5. Debug  > right click any module  > open all modules
6. View > Assembly Explorer (wait for all to load) > right click > Sort Assemblies
7. Navigate to the vulnerable function
8. Set break point

### Locate Method
1. Edit > Search Assemblies

### Quickly debug an EXE entry point
1. Debug > Start Debugging
2. Select Program
3. Select "Break at: Entry Point"

---
